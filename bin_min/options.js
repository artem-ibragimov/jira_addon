"use strict";class e{constructor(e){if(this._ref=document.querySelector(e),!this._ref)throw new Error(`Element with selector ${e} not found`);this._ref.addEventListener("dragover",(e=>{e.dataTransfer&&(e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy")}))}onFileDropped(e){this._ref?.addEventListener("drop",(t=>{if(!t.dataTransfer)return;t.stopPropagation(),t.preventDefault();const r=t.dataTransfer.files,n=new FileReader;n.addEventListener("loadend",(t=>{try{const r=JSON.parse(t.target?.result);e(r)}catch(e){alert("Incorrect file: "+e.message)}})),n.readAsText(r[0])}))}}const t={origins:[],request_interval:500};var r;!function(e){e.WordPress="WordPress"}(r||(r={}));const n=[r.WordPress];class s{constructor(e){this.default_data=e,this.onerror=this.onerror.bind(this),this.onload=this.onload.bind(this),this.data=e}async load(e,t){return s.request(t).then((t=>this.onload(e,t))).catch(this.onerror)}static request(e){return new Promise((t=>{chrome.runtime.sendMessage({url:e.url,options:e},t)})).then((e=>{if(0===Object.keys(e).length)throw new Error("Failed to load");return e}))}has(e){return e in this.data}onerror(e){this.data=this.default_data,console.error(e)}}class i extends class{constructor(e,t,r=!0){this.request_interval=t,this.wrap_link=r,this.listenUserActions=()=>Promise.resolve(""),this.update=t=>e(t).then(this.updateContent)}show(e){return new Promise(((t,r)=>{const[n]=this.listenPopupCloseEvents(t,r);this.overlay=this.createOverlayElement(),this.popup=this.createPopupElement(this.getContent(e)),this.popup.addEventListener("keyup",n),this.overlay.appendChild(this.popup),document.body.appendChild(this.overlay),this.listenUserActions().then(t,r)}))}close(){this.overlay?.remove()}listenPopupCloseEvents(e,t){const r=()=>{document.removeEventListener("click",n),this.close(),t(new Error("No value"))},n=e=>{this.popup&&e.composedPath().includes(this.popup)||r()};document.addEventListener("click",n);const s=e=>{"Escape"===e.code&&(e.stopPropagation(),r())};return document.addEventListener("keyup",s),[s]}createOverlayElement(){const e=document.createElement("div");return e.setAttribute("style","justify-content: center;\n         align-items: center;\n         position: fixed;\n         z-index: 999999;\n         display: flex;\n         bottom: 0;\n         right: 0;\n         left: 0;\n         top: 0;\n         "),e}createPopupElement(e){const t=document.createElement("div");return t.setAttribute("style","\n         border: 1px solid #ccc;\n         border-radius: 5px;\n         position: absolute;\n         line-height: 1 !important;\n         background: #eee;\n         padding: 10px;\n         margin: auto;\n         width: 500px;\n         "),e.forEach((e=>{t.appendChild(e)})),t}}{constructor(){super(...arguments),this.updateContent=e=>{this.search_results&&(this.search_results.innerHTML=e.map(c).join("\n"))},this.listenUserActions=()=>new Promise((e=>{if(!this.search_field)return e("");let t="";this.search_field.addEventListener("keyup",(r=>{this.search_field.value!==t&&(t=this.search_field.value,clearTimeout(this.timeoutID),this.timeoutID=setTimeout((()=>{this.update(this.search_field.value).then((()=>{this.initHotKeys(e)}))}),this.request_interval))})),this.search_field?.focus()})).then((e=>(this.close(),e)))}getContent(){return this.search_field=document.createElement("input"),this.search_field.classList.add("QuickLink__SearchPopup__search_field"),this.search_field.setAttribute("data-replace","disable"),this.search_field.setAttribute("autofocus","true"),this.search_field.setAttribute("placeholder","Search links"),this.search_field.setAttribute("style","\n         margin: 0 !important;\n         height: 25px;\n         width: 100%;\n         box-shadow: inset 0 1px 3px #ddd;\n         letter-spacing: .01em;\n         border: 1px solid #ccc;\n         box-sizing: border-box;\n         border-radius: 3px;\n         text-transform: none;\n         padding: 4px; "),this.search_results=document.createElement("div"),this.search_results.classList.add("QuickLink__SearchPopup__results_list"),this.search_results.setAttribute("style","flex-direction: column;\n         cursor: pointer;\n         display:flex;\n      "),[this.search_field,this.search_results]}initHotKeys(e){this.search_results.addEventListener("click",(t=>{if(!t.target.hasAttribute("wrapped_url"))return;document.removeEventListener("keyup",s);const r=t.target.getAttribute(this.wrap_link?"wrapped_url":"url")||"";e(r)}));const t=Array.from(this.search_results.querySelectorAll("span"));if(0===t.length)return;let r=0;const n=()=>{t[r].parentElement?.setAttribute("style",o)},s=i=>{if("Enter"!==i.code)"ArrowDown"===i.code||"ArrowUp"===i.code?(i.preventDefault(),t[r].parentElement?.setAttribute("style",a),"ArrowDown"===i.code&&(r+=1),"ArrowUp"===i.code&&(r-=1),r>t.length-1&&(r-=t.length),r<0&&(r+=t.length),n()):document.removeEventListener("keyup",s);else{document.removeEventListener("keyup",s);const n=t[r].getAttribute(this.wrap_link?"wrapped_url":"url")||"";e(n)}};n(),document.addEventListener("keyup",s)}}const a="\njustify-content: space-between;\npadding: 3px;\ndisplay: flex;\ncolor: #111;",o=`\n${a}\nfont-weight: 700;\nbackground: #ddd;`,c=({title:e,url:t})=>`<div style="${a}">\n      <span\n         style="font-size: 16px; padding: 0 4px; flex-grow: 1;"\n         url="${t}"\n         wrapped_url="<a href='${t}'>${e}</a>">\n         ${e}\n      </span>\n      <a href="${t}" target="blank">\n         <img\n            draggable="false"\n            role="img"\n            style="display: inline !important;\n               border: none !important;\n               box-shadow: none !important;\n               height: 18px !important;\n               width: 18px !important;\n               margin: 0 2px !important;\n               vertical-align: -0.1em !important;\n               background: none !important;\n               padding: 0 !important;"\n            alt="↗️"\n            src="https://s.w.org/images/core/emoji/13.0.1/svg/2197.svg">\n      </a>\n   </div>`;class l extends s{constructor(e,t){super(Object.fromEntries(e.map((({shortcut:e})=>[e,[]])))),this.request_interval=t,this.settings=Object.fromEntries(e.map((e=>[e.shortcut,e])))}get(e,{wrap_link:t}){return new i((t=>this.update(e,t).then((()=>this.data[e]))),this.request_interval,t).show("")}async update(e,t){return t?this.load(e,{url:l.createURL(this.settings[e],t)}):Promise.resolve()}static createURL({url:e,per_page:t,pages:r},n){return`${e}/wp-json/wp/v2/search?search=${n}&per_page=${t}&page=${r}`}static checkURL(e){return s.request({url:this.createURL({...u,url:e},"")})}onload(e,t){this.data[e]=t.map((({title:e,url:t})=>({title:e,url:t})))}static from(e,t){const n=e.filter((({sourceType:e})=>e===r.WordPress));return 0===n.length?null:new l(n,t)}}const d={sourceType:r.WordPress,url:"https://wordpress.org/support/",shortcut:"wpsupport:",per_page:5,pages:1},u={sourceType:r.WordPress,shortcut:"",per_page:5,pages:1,url:""};var p;function h(e,t){e.style.background=t}function m(e){const t=f(e);t&&t.remove()}function f(e){const t=Array.from(e.classList.values()).find((e=>e.includes("tooltip_")));if(t)return document.querySelector(`span.${t}`)}!function(e){e.GREEN="#f0fff0",e.RED="#ffe7e7"}(p||(p={}));class g{constructor(e,t){this.container=e,this.addBtn=t,this.renderFields=this.renderFields.bind(this),this.onFieldInput=this.onFieldInput.bind(this),this.createEmptyField=this.createEmptyField.bind(this),this.addBtn.addEventListener("click",this.createEmptyField),this.container.addEventListener("click",b),this.container.addEventListener("input",this.onFieldInput)}render(e){this.removeFields(),0!==e.length?e.forEach(this.renderFields):this.renderFields(d)}getSettings(){return Array.from(this.container.querySelectorAll("div.shortcut_fields")).map((e=>Array.from(e.querySelectorAll("[data]")).map((e=>({[e.getAttribute("data")]:e.value}))).reduce(((e,t)=>({...e,...t})),u))).filter((({shortcut:e})=>""!==e))}removeFields(){this.container.querySelectorAll("div.shortcut_fields").forEach((e=>{m(e),e.remove()}))}createEmptyField(){this.renderFields({per_page:5,pages:1})}renderFields(e){const[t,r,s]=this.createLinkParams(e),i=E([this.createTypeSelect(n,e?.sourceType),t,r,s,v()]);!function(e){const t=`tooltip_${Math.random().toPrecision(7).replace(".","")}`,r=document.createElement("span");r.setAttribute("hidden","true"),r.classList.add("tooltiptext",t),e.classList.add("tooltip",t),document.body.appendChild(r)}(r),this.validateFieldContainer(i),i.classList.add("shortcut_fields"),this.container.appendChild(i)}createTypeSelect(e,t){const r=document.createElement("select");return r.setAttribute("data","dataSourceType"),e.map((e=>{const r=document.createElement("option");return r.innerText=e,e===t&&(r.selected=!0),r})).forEach((e=>{r.appendChild(e)})),r}createLinkParams({shortcut:e,url:t,per_page:r}={}){const n=document.createElement("input");n.setAttribute("data","shortcut"),n.setAttribute("placeholder","shortcut, e.x link:"),n.setAttribute("type","text"),n.classList.add("smooth"),e&&(n.value=e);const s=document.createElement("input");s.setAttribute("data","url"),s.setAttribute("placeholder","url, e.x. https://wordpress.org/"),s.setAttribute("type","url"),s.classList.add("smooth"),t&&(s.value=t);const i=document.createElement("input");return i.setAttribute("data","per_page"),i.setAttribute("placeholder","Links per page"),i.setAttribute("type","number"),i.setAttribute("max","10"),i.setAttribute("min","1"),i.classList.add("smooth"),r&&(i.value=`${r}`),[n,s,i]}onFieldInput(e){const t=e.target,r=t.getAttribute("data");"url"!==r&&"dataSourceType"!==r||this.validateFieldContainer(t.parentElement)}validateFieldContainer(e){if(!e)return;const t=e.querySelector("[data=dataSourceType]"),n=e.querySelector("[data=url]");t.value===r.WordPress&&n.value&&l.checkURL(n.value).then((()=>{h(n,p.GREEN),function(e){const t=f(e);t&&t.setAttribute("hidden","true")}(n)})).catch((()=>{h(n,p.RED),function(e,t){const r=f(e);r&&(r.innerHTML=t,r.removeAttribute("hidden"),r.setAttribute("style",`top: ${e.offsetTop+e.clientHeight+6}px;\n      left: ${e.offsetLeft}px;\n      width: ${e.offsetWidth}px;`))}(n,"The URL does not use the WordPress REST API")}))}}class y{constructor(e){this.container=e,this.renderParams=this.renderParams.bind(this),this.createEmptyField=this.createEmptyField.bind(this),this.container.addEventListener("click",b)}render(e){this.removeFields(),this.renderParams(e)}getSettings(){const e=this.container.querySelector("[data=origins]")?.value.split("\n").map((e=>e.trim())).filter((e=>""!==e))||t.origins,r=this.container.querySelector("[data=request_interval]");return{origins:e,request_interval:r?.value&&parseInt(r.value,10)||t.request_interval}}removeFields(){this.container.querySelectorAll("div.application_fields").forEach((e=>{e.remove()}))}createEmptyField(){this.renderParams(t)}renderParams(e){const t=E(this.createAppParams(e));t.classList.add("application_fields"),this.container.appendChild(t)}createAppParams({origins:e}){const t=document.createElement("textarea");return t.setAttribute("data","origins"),t.setAttribute("placeholder","Leave empty to enable the extension on all URLs\nSet a URL per line to enable it only on specific domains"),t.setAttribute("type","text"),t.value=e.join("\n"),[t]}}function v(){const e=document.createElement("button");return e.classList.add("remove_button","small_width"),e.innerHTML="x",e}function b(e){if(!e.target?.classList.contains("remove_button"))return;const t=e.target.parentElement;t&&(t.querySelectorAll("input").forEach((e=>{m(e)})),t.remove())}function E(e){const t=document.createElement("div");return t.classList.add("flex","full_width","content-end","padding-top"),e.forEach((e=>{t.appendChild(e)})),t}class _{constructor({onUpdate:e}={onUpdate:()=>{}}){this.applySettings=this.applySettings.bind(this),this.onUpdate=e}getSettings(){return new Promise(((e,t)=>{chrome.storage.sync.get("settings",(t=>{e(t&&t.settings)}))})).then((e=>e?JSON.parse(e):w))}async applySettings(e){if(!e)throw new Error("Settings formatted incorrectly");await this.saveSettings(e),this.onUpdate(e)}saveSettings(e){return new Promise(((t,r)=>{chrome.storage.sync.set({settings:e},t)}))}}const w={application:t,shortcuts:[d]};!async function(){const t=document.querySelector("#applicationContainer"),r=new y(t),n=document.querySelector("#shortcutsContainer"),s=document.querySelector("#addShortcut"),i=new g(n,s),a=new _({onUpdate:e=>{const{application:t,shortcuts:n}=JSON.parse(e);r.render(t),i.render(n)}});window.onunload=()=>{const e={application:r.getSettings(),shortcuts:i.getSettings()};a.applySettings(JSON.stringify(e))};new e("#drop-area").onFileDropped(a.applySettings);document.querySelector("#download").onclick=()=>{const e={application:r.getSettings(),shortcuts:i.getSettings()};!function(e,t){const r=document.createElement("a");document.body.appendChild(r),r.setAttribute("style","display: none");const n=JSON.stringify(e,null,4),s=new Blob([n],{type:"text/plain;charset=utf-8"}),i=window.URL.createObjectURL(s);r.href=i,r.download=t,r.click(),window.URL.revokeObjectURL(i)}(JSON.stringify(e),"QuickLinkSettings.json")};const o=await a.getSettings();r.render(o.application),i.render(o.shortcuts)}();
