"use strict";class e{constructor(e){if(this._ref=document.querySelector(e),!this._ref)throw new Error(`Element with selector ${e} not found`);this._ref.addEventListener("dragover",(e=>{e.dataTransfer&&(e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy")}))}onFileDropped(e){this._ref?.addEventListener("drop",(t=>{if(!t.dataTransfer)return;t.stopPropagation(),t.preventDefault();const r=t.dataTransfer.files,n=new FileReader;n.addEventListener("loadend",(t=>{try{const r=JSON.parse(t.target?.result);e(r)}catch(e){alert("Incorrect file: "+e.message)}})),n.readAsText(r[0])}))}}const t={origins:[],request_interval:500};var r;!function(e){e.WordPress="WordPress"}(r||(r={}));const n=[r.WordPress],s={sourceType:r.WordPress,url:"https://wordpress.org/support/",shortcut:"wpsupport:",per_page:5,pages:1},i={sourceType:r.WordPress,shortcut:"",per_page:5,pages:1,url:""};class a{constructor(e,t){this.container=e,this.addBtn=t,this.renderFields=this.renderFields.bind(this),this.createEmptyField=this.createEmptyField.bind(this),this.addBtn.addEventListener("click",this.createEmptyField),this.container.addEventListener("click",d)}render(e){this.removeFields(),0!==e.length?e.forEach(this.renderFields):this.renderFields(s)}getSettings(){return Array.from(this.container.querySelectorAll("div.shortcut_fields")).map((e=>Array.from(e.querySelectorAll("[data]")).map((e=>({[e.getAttribute("data")]:e.value}))).reduce(((e,t)=>({...e,...t})),i))).filter((({shortcut:e})=>""!==e))}removeFields(){this.container.querySelectorAll("div.shortcut_fields").forEach((e=>{e.remove()}))}createEmptyField(){this.renderFields({per_page:5,pages:1})}renderFields(e){const t=l([this.createTypeSelect(n,e?.sourceType),...this.createLinkParams(e),c()]);t.classList.add("shortcut_fields"),this.container.appendChild(t)}createTypeSelect(e,t){const r=document.createElement("select");return r.setAttribute("data","dataSourceType"),e.map((e=>{const r=document.createElement("option");return r.innerText=e,e===t&&(r.selected=!0),r})).forEach((e=>{r.appendChild(e)})),r}createLinkParams({shortcut:e,url:t,per_page:r}={}){const n=document.createElement("input");n.setAttribute("data","shortcut"),n.setAttribute("placeholder","shortcut, e.x link:"),n.setAttribute("type","text"),e&&(n.value=e);const s=document.createElement("input");s.setAttribute("data","url"),s.setAttribute("placeholder","url, e.x. https://wordpress.org/"),s.setAttribute("type","url"),t&&(s.value=t);const i=document.createElement("input");return i.setAttribute("data","per_page"),i.setAttribute("placeholder","Links per page"),i.setAttribute("type","number"),i.setAttribute("max","10"),i.setAttribute("min","1"),r&&(i.value=`${r}`),[n,s,i]}}class o{constructor(e){this.container=e,this.renderParams=this.renderParams.bind(this),this.createEmptyField=this.createEmptyField.bind(this),this.container.addEventListener("click",d)}render(e){this.removeFields(),this.renderParams(e)}getSettings(){const e=this.container.querySelector("[data=origins]")?.value.split("\n").map((e=>e.trim())).filter((e=>""!==e))||t.origins,r=this.container.querySelector("[data=request_interval]");return{origins:e,request_interval:r?.value&&parseInt(r.value,10)||t.request_interval}}removeFields(){this.container.querySelectorAll("div.application_fields").forEach((e=>{e.remove()}))}createEmptyField(){this.renderParams(t)}renderParams(e){const t=l(this.createAppParams(e));t.classList.add("application_fields"),this.container.appendChild(t)}createAppParams({origins:e}){const t=document.createElement("textarea");return t.setAttribute("data","origins"),t.setAttribute("placeholder","use one line per URL"),t.setAttribute("type","text"),t.value=e.join("\n"),[t]}}function c(){const e=document.createElement("button");return e.classList.add("remove_button","small_width"),e.innerHTML="x",e}function d(e){e.target?.classList.contains("remove_button")&&e.target.parentElement?.remove()}function l(e){const t=document.createElement("div");return t.classList.add("flex","full_width","content-end","padding-top"),e.forEach((e=>{t.appendChild(e)})),t}class p{constructor({onUpdate:e}={onUpdate:()=>{}}){this.applySettings=this.applySettings.bind(this),this.onUpdate=e}getSettings(){return new Promise(((e,t)=>{chrome.storage.sync.get("settings",(t=>{e(t&&t.settings)}))})).then((e=>e?JSON.parse(e):u))}async applySettings(e){if(!e)throw new Error("Settings formatted incorrectly");await this.saveSettings(e),this.onUpdate(e)}saveSettings(e){return new Promise(((t,r)=>{chrome.storage.sync.set({settings:e},t)}))}}const u={application:t,shortcuts:[s]};!async function(){const t=document.querySelector("#applicationContainer"),r=new o(t),n=document.querySelector("#shortcutsContainer"),s=document.querySelector("#addShortcut"),i=new a(n,s),c=new p({onUpdate:e=>{const{application:t,shortcuts:n}=JSON.parse(e);r.render(t),i.render(n)}});window.onunload=()=>{const e={application:r.getSettings(),shortcuts:i.getSettings()};c.applySettings(JSON.stringify(e))};new e("#drop-area").onFileDropped(c.applySettings);document.querySelector("#download").onclick=()=>{const e={application:r.getSettings(),shortcuts:i.getSettings()};!function(e,t){const r=document.createElement("a");document.body.appendChild(r),r.setAttribute("style","display: none");const n=JSON.stringify(e,null,4),s=new Blob([n],{type:"text/plain;charset=utf-8"}),i=window.URL.createObjectURL(s);r.href=i,r.download=t,r.click(),window.URL.revokeObjectURL(i)}(JSON.stringify(e),"QuickLinkSettings.json")};const d=await c.getSettings();r.render(d.application),i.render(d.shortcuts)}();
