"use strict";class t{constructor(t){if(this._ref=document.querySelector(t),!this._ref)throw new Error(`Element with selector ${t} not found`);this._ref.addEventListener("dragover",(t=>{t.dataTransfer&&(t.stopPropagation(),t.preventDefault(),t.dataTransfer.dropEffect="copy")}))}onFileDropped(t){this._ref?.addEventListener("drop",(e=>{if(!e.dataTransfer)return;e.stopPropagation(),e.preventDefault();const r=e.dataTransfer.files,n=new FileReader;n.addEventListener("loadend",(e=>{try{const r=JSON.parse(e.target?.result);t(r)}catch(t){alert("Incorrect file: "+t.message)}})),n.readAsText(r[0])}))}}const e={origins:[],request_interval:500};var r;!function(t){t.WordPress="WordPress"}(r||(r={}));const n=[r.WordPress];class s{constructor(t){this.default_data=t,this.onerror=this.onerror.bind(this),this.onload=this.onload.bind(this),this.data=t}async load(t,e){return s.request(e).then((e=>this.onload(t,e))).catch(this.onerror)}static request(t){return new Promise((e=>{chrome.runtime.sendMessage({url:t.url,options:t},e)})).then((t=>{if(0===Object.keys(t).length)throw new Error("Failed to load");return t}))}has(t){return t in this.data}onerror(t){this.data=this.default_data,console.error(t)}}class i extends class{constructor(t,e,r=!0){this.request_interval=e,this.wrap_link=r,this.listenUserActions=()=>Promise.resolve(""),this.update=e=>t(e).then(this.updateContent)}show(t){return new Promise(((e,r)=>{const[n]=this.listenPopupCloseEvents(e,r);this.overlay=this.createOverlayElement(),this.popup=this.createPopupElement(this.getContent(t)),this.popup.addEventListener("keyup",n),this.overlay.appendChild(this.popup),document.body.appendChild(this.overlay),this.listenUserActions().then(e,r)}))}close(){this.overlay?.remove()}listenPopupCloseEvents(t,e){const r=()=>{document.removeEventListener("click",n),this.close(),e(new Error("No value"))},n=t=>{this.popup&&t.composedPath().includes(this.popup)||r()};document.addEventListener("click",n);const s=t=>{"Escape"===t.code&&(t.stopPropagation(),r())};return document.addEventListener("keyup",s),[s]}createOverlayElement(){const t=document.createElement("div");return t.setAttribute("style","justify-content: center;\n         align-items: center;\n         position: fixed;\n         z-index: 999999;\n         display: flex;\n         bottom: 0;\n         right: 0;\n         left: 0;\n         top: 0;\n         "),t}createPopupElement(t){const e=document.createElement("div");return e.setAttribute("style","\n         border: 1px solid #ccc;\n         border-radius: 5px;\n         position: absolute;\n         line-height: 1 !important;\n         background: #eee;\n         padding: 10px;\n         margin: auto;\n         width: 500px;\n         "),t.forEach((t=>{e.appendChild(t)})),e}}{constructor(){super(...arguments),this.updateContent=t=>{this.search_results&&(this.search_results.innerHTML=t.map(c).join("\n"))},this.listenUserActions=()=>new Promise((t=>{if(!this.search_field)return t("");let e="";this.search_field.addEventListener("keyup",(r=>{this.search_field.value!==e&&(e=this.search_field.value,clearTimeout(this.timeoutID),this.timeoutID=setTimeout((()=>{this.update(this.search_field.value).then((()=>{this.initHotKeys(t)}))}),this.request_interval))})),this.search_field?.focus()})).then((t=>(this.close(),t)))}getContent(){return this.search_field=document.createElement("input"),this.search_field.classList.add("QuickLink__SearchPopup__search_field"),this.search_field.setAttribute("data-replace","disable"),this.search_field.setAttribute("autofocus","true"),this.search_field.setAttribute("placeholder","Search links"),this.search_field.setAttribute("style","\n         margin: 0 !important;\n         height: 25px;\n         width: 100%;\n         box-shadow: inset 0 1px 3px #ddd;\n         letter-spacing: .01em;\n         border: 1px solid #ccc;\n         box-sizing: border-box;\n         border-radius: 3px;\n         text-transform: none;\n         padding: 4px; "),this.search_results=document.createElement("div"),this.search_results.classList.add("QuickLink__SearchPopup__results_list"),this.search_results.setAttribute("style","flex-direction: column;\n         cursor: pointer;\n         display:flex;\n      "),[this.search_field,this.search_results]}initHotKeys(t){this.search_results.addEventListener("click",(e=>{if(!e.target.hasAttribute("wrapped_url"))return;document.removeEventListener("keyup",s);const r=e.target.getAttribute(this.wrap_link?"wrapped_url":"url")||"";t(r)}));const e=Array.from(this.search_results.querySelectorAll("span"));if(0===e.length)return;let r=0;const n=()=>{e[r].parentElement?.setAttribute("style",o)},s=i=>{if("Enter"!==i.code)"ArrowDown"===i.code||"ArrowUp"===i.code?(i.preventDefault(),e[r].parentElement?.setAttribute("style",a),"ArrowDown"===i.code&&(r+=1),"ArrowUp"===i.code&&(r-=1),r>e.length-1&&(r-=e.length),r<0&&(r+=e.length),n()):document.removeEventListener("keyup",s);else{document.removeEventListener("keyup",s);const n=e[r].getAttribute(this.wrap_link?"wrapped_url":"url")||"";t(n)}};n(),document.addEventListener("keyup",s)}}const a="\njustify-content: space-between;\npadding: 3px;\ndisplay: flex;\ncolor: #111;",o=`\n${a}\nfont-weight: 700;\nbackground: #ddd;`,c=({title:t,url:e})=>`<div style="${a}">\n      <span\n         style="font-size: 16px; padding: 0 4px; flex-grow: 1;"\n         url="${e}"\n         wrapped_url="<a href='${e}'>${t}</a>">\n         ${t}\n      </span>\n      <a href="${e}" target="blank">\n         <img\n            draggable="false"\n            role="img"\n            style="display: inline !important;\n               border: none !important;\n               box-shadow: none !important;\n               height: 18px !important;\n               width: 18px !important;\n               margin: 0 2px !important;\n               vertical-align: -0.1em !important;\n               background: none !important;\n               padding: 0 !important;"\n            alt="↗️"\n            src="https://s.w.org/images/core/emoji/13.0.1/svg/2197.svg">\n      </a>\n   </div>`;class l extends s{constructor(t,e){super(Object.fromEntries(t.map((({shortcut:t})=>[t,[]])))),this.request_interval=e,this.settings=Object.fromEntries(t.map((t=>[t.shortcut,t])))}get(t,{wrap_link:e}){return new i((e=>this.update(t,e).then((()=>this.data[t]))),this.request_interval,e).show("")}async update(t,e){return e?this.load(t,{url:l.createURL(this.settings[t],e)}):Promise.resolve()}static createURL({url:t,per_page:e,pages:r},n){return`${t}/wp-json/wp/v2/search?search=${n}&per_page=${e}&page=${r}`}static checkURL(t){return s.request({url:this.createURL({...u,url:t},"")})}onload(t,e){this.data[t]=e.map((({title:t,url:e})=>({title:t,url:e})))}static from(t,e){const n=t.filter((({sourceType:t})=>t===r.WordPress));return 0===n.length?null:new l(n,e)}}const d={sourceType:r.WordPress,url:"https://wordpress.org/support/",shortcut:"wpsupport:",per_page:5,pages:1},u={sourceType:r.WordPress,shortcut:"",per_page:5,pages:1,url:""};var p;function h(t,e){t.style.background=e}function m(t){const e=f(t);e&&e.remove()}function f(t){const e=Array.from(t.classList.values()).find((t=>t.includes("tooltip_")));if(e)return document.querySelector(`span.${e}`)}!function(t){t.GREEN="#f0fff0",t.RED="#ffe7e7"}(p||(p={}));class g{constructor(t,e){this.container=t,this.addBtn=e,this.renderFields=this.renderFields.bind(this),this.onFieldInput=this.onFieldInput.bind(this),this.createEmptyField=this.createEmptyField.bind(this),this.addBtn.addEventListener("click",this.createEmptyField),this.container.addEventListener("click",b),this.container.addEventListener("input",this.onFieldInput)}render(t){this.removeFields(),0!==t.length?t.forEach(this.renderFields):this.renderFields(d)}getSettings(){return Array.from(this.container.querySelectorAll("div.shortcut_fields")).map((t=>Array.from(t.querySelectorAll("[data]")).map((t=>({[t.getAttribute("data")]:t.value}))).reduce(((t,e)=>({...t,...e})),u))).filter((({shortcut:t})=>""!==t))}removeFields(){this.container.querySelectorAll("div.shortcut_fields").forEach((t=>{m(t),t.remove()}))}createEmptyField(){this.renderFields({per_page:5,pages:1})}renderFields(t){const[e,r,s]=this.createLinkParams(t),i=E([this.createTypeSelect(n,t?.sourceType),e,r,s,v()]);!function(t){const e=`tooltip_${Math.random().toPrecision(7).replace(".","")}`,r=document.createElement("span");r.setAttribute("hidden","true"),r.classList.add("tooltiptext",e),t.classList.add("tooltip",e),document.body.appendChild(r)}(r),this.validateFieldContainer(i),i.classList.add("shortcut_fields"),this.container.appendChild(i)}createTypeSelect(t,e){const r=document.createElement("select");return r.setAttribute("data","dataSourceType"),t.map((t=>{const r=document.createElement("option");return r.innerText=t,t===e&&(r.selected=!0),r})).forEach((t=>{r.appendChild(t)})),r}createLinkParams({shortcut:t,url:e,per_page:r}={}){const n=document.createElement("input");n.setAttribute("data","shortcut"),n.setAttribute("placeholder","shortcut, e.x link:"),n.setAttribute("type","text"),n.classList.add("smooth"),t&&(n.value=t);const s=document.createElement("input");s.setAttribute("data","url"),s.setAttribute("placeholder","url, e.x. https://wordpress.org/"),s.setAttribute("type","url"),s.classList.add("smooth"),e&&(s.value=e);const i=document.createElement("input");return i.setAttribute("data","per_page"),i.setAttribute("placeholder","Links per page"),i.setAttribute("type","number"),i.setAttribute("max","10"),i.setAttribute("min","1"),i.classList.add("smooth"),r&&(i.value=`${r}`),[n,s,i]}onFieldInput(t){const e=t.target,r=e.getAttribute("data");"url"!==r&&"dataSourceType"!==r||this.validateFieldContainer(e.parentElement)}validateFieldContainer(t){if(!t)return;const e=t.querySelector("[data=dataSourceType]"),n=t.querySelector("[data=url]");e.value===r.WordPress&&n.value&&l.checkURL(n.value).then((()=>{h(n,p.GREEN),function(t){const e=f(t);e&&e.setAttribute("hidden","true")}(n)})).catch((()=>{h(n,p.RED),function(t,e){const r=f(t);r&&(r.innerHTML=e,r.removeAttribute("hidden"),r.setAttribute("style",`top: ${t.offsetTop+t.clientHeight+6}px;\n      left: ${t.offsetLeft}px;\n      width: ${t.offsetWidth}px;`))}(n,"The URL does not use the WordPress REST API")}))}}class y{constructor(t){this.container=t,this.renderParams=this.renderParams.bind(this),this.createEmptyField=this.createEmptyField.bind(this),this.container.addEventListener("click",b)}render(t){this.removeFields(),this.renderParams(t)}getSettings(){const t=this.container.querySelector("[data=origins]")?.value.split("\n").map((t=>t.trim())).filter((t=>""!==t))||e.origins,r=this.container.querySelector("[data=request_interval]");return{origins:t,request_interval:r?.value&&parseInt(r.value,10)||e.request_interval}}removeFields(){this.container.querySelectorAll("div.application_fields").forEach((t=>{t.remove()}))}createEmptyField(){this.renderParams(e)}renderParams(t){const e=E(this.createAppParams(t));e.classList.add("application_fields"),this.container.appendChild(e)}createAppParams({origins:t}){const e=document.createElement("textarea");return e.setAttribute("data","origins"),e.setAttribute("placeholder","use one line per URL"),e.setAttribute("type","text"),e.value=t.join("\n"),[e]}}function v(){const t=document.createElement("button");return t.classList.add("remove_button","small_width"),t.innerHTML="x",t}function b(t){if(!t.target?.classList.contains("remove_button"))return;const e=t.target.parentElement;e&&(e.querySelectorAll("input").forEach((t=>{m(t)})),e.remove())}function E(t){const e=document.createElement("div");return e.classList.add("flex","full_width","content-end","padding-top"),t.forEach((t=>{e.appendChild(t)})),e}class _{constructor({onUpdate:t}={onUpdate:()=>{}}){this.applySettings=this.applySettings.bind(this),this.onUpdate=t}getSettings(){return new Promise(((t,e)=>{chrome.storage.sync.get("settings",(e=>{t(e&&e.settings)}))})).then((t=>t?JSON.parse(t):w))}async applySettings(t){if(!t)throw new Error("Settings formatted incorrectly");await this.saveSettings(t),this.onUpdate(t)}saveSettings(t){return new Promise(((e,r)=>{chrome.storage.sync.set({settings:t},e)}))}}const w={application:e,shortcuts:[d]};!async function(){const e=document.querySelector("#applicationContainer"),r=new y(e),n=document.querySelector("#shortcutsContainer"),s=document.querySelector("#addShortcut"),i=new g(n,s),a=new _({onUpdate:t=>{const{application:e,shortcuts:n}=JSON.parse(t);r.render(e),i.render(n)}});window.onunload=()=>{const t={application:r.getSettings(),shortcuts:i.getSettings()};a.applySettings(JSON.stringify(t))};new t("#drop-area").onFileDropped(a.applySettings);document.querySelector("#download").onclick=()=>{const t={application:r.getSettings(),shortcuts:i.getSettings()};!function(t,e){const r=document.createElement("a");document.body.appendChild(r),r.setAttribute("style","display: none");const n=JSON.stringify(t,null,4),s=new Blob([n],{type:"text/plain;charset=utf-8"}),i=window.URL.createObjectURL(s);r.href=i,r.download=e,r.click(),window.URL.revokeObjectURL(i)}(JSON.stringify(t),"QuickLinkSettings.json")};const o=await a.getSettings();r.render(o.application),i.render(o.shortcuts)}();
